2024-05-31 20:18:57,995 - logs - INFO - Programming Languages: ['Java']
2024-05-31 20:18:59,869 - logs - INFO - ==================================================
2024-05-31 20:18:59,869 - logs - INFO - Logging  at: logs/run-2024-05-31--20-18-57.log
2024-05-31 20:18:59,869 - logs - INFO - Config: {'base_model': 'Salesforce/codet5-base', 'debug_mode': False, 'generation': {'max_new_tokens': 512, 'do_sample': True, 'temperature': 2.0, 'num_beams': 1, 'tokenizer': 'roberta'}, 'fine_tuning': {'output_dir': 'models', 'learning_rate': '1e-5', 'num_train_epochs': 100, 'weight_decay': 0.01, 'logging_steps': 100, 'max_steps': 100}, 'preprocess': {'db_file': 'data/FixMe-v1.db', 'max_hunks_per_url': 1, 'prog_lang': ['Java']}, 'run_id': '2024-05-31--20-18-57'}
2024-05-31 20:18:59,869 - logs - INFO - ==================================================
2024-05-31 20:19:01,891 - logs - INFO - Dataset shape: (71, 4)
2024-05-31 20:19:01,892 - logs - INFO - Columns in hunk_collection: 
Index(['code_before', 'code_after', 'topic', 'programming_language'], dtype='object')

2024-05-31 20:19:01,932 - logs - INFO - Train shape: (56, 5)
2024-05-31 20:19:01,932 - logs - INFO - Validation shape: (7, 5)
2024-05-31 20:19:01,932 - logs - INFO - Test shape: (8, 5)
2024-05-31 20:19:02,100 - logs - INFO - Tokenizer loaded successfully!
2024-05-31 20:19:04,325 - logs - INFO - Model loaded successfully!
2024-05-31 20:19:04,325 - logs - INFO - Original Model: Salesforce/codet5-base
2024-05-31 20:19:04,325 - logs - INFO - ==================================================
2024-05-31 20:19:04,325 - logs - DEBUG - Test the Model generating a simple code snippet
2024-05-31 20:19:05,365 - logs - DEBUG - Model generated output: {user.username} {user.password} {user.email} {user
2024-05-31 20:19:05,365 - logs - INFO - ==================================================
2024-05-31 20:19:05,365 - logs - INFO - ==================================================
2024-05-31 20:19:05,365 - logs - INFO - Generate Patch without Prompt Engineering
2024-05-31 20:19:05,365 - logs - INFO - ==================================================
2024-05-31 20:19:05,996 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:05,996 - logs - INFO - INPUT PROMPT:

    vulnerable program code:

                }
        }
    }
}


    Patch of the program is:
    
2024-05-31 20:19:05,996 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:05,996 - logs - INFO - BASELINE PATCH:
            }
        }
    }
}


2024-05-31 20:19:05,996 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:05,996 - logs - INFO - MODEL GENERATION - ZERO SHOT:
{{{{
2024-05-31 20:19:06,623 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:06,624 - logs - INFO - INPUT PROMPT:

    vulnerable program code:

                }
        }
    }
}


    Patch of the program is:
    
2024-05-31 20:19:06,624 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:06,624 - logs - INFO - BASELINE PATCH:
            }
        }
    }
}


2024-05-31 20:19:06,624 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:06,624 - logs - INFO - MODEL GENERATION - ZERO SHOT:
{{{{
2024-05-31 20:19:07,251 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:07,252 - logs - INFO - INPUT PROMPT:

    vulnerable program code:

                }
        }
    }
}


    Patch of the program is:
    
2024-05-31 20:19:07,252 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:07,252 - logs - INFO - BASELINE PATCH:
package com.fasterxml.sort.std;

import java.io.*;
import java.nio.file.Files;

import com.fasterxml.sort.TempFileProvider;



2024-05-31 20:19:07,252 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:07,252 - logs - INFO - MODEL GENERATION - ZERO SHOT:
{{{{
2024-05-31 20:19:07,879 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:07,879 - logs - INFO - INPUT PROMPT:

    vulnerable program code:

                }
        }
    }
}


    Patch of the program is:
    
2024-05-31 20:19:07,879 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:07,879 - logs - INFO - BASELINE PATCH:

    public static void zipFolderAPKTool(String srcFolder, String destZipFile) throws Exception {
        try (FileOutputStream fileWriter = new FileOutputStream(destZipFile);
             ZipOutputStream zip = new ZipOutputStream(fileWriter)) {
            addFolderToZipAPKTool("", srcFolder, zip);
            zip.flush();
        }


2024-05-31 20:19:07,879 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:07,879 - logs - INFO - MODEL GENERATION - ZERO SHOT:
{{{{
2024-05-31 20:19:10,938 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:10,938 - logs - INFO - INPUT PROMPT:

    vulnerable program code:

                }
        }
    }
}


    Patch of the program is:
    
2024-05-31 20:19:10,938 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:10,938 - logs - INFO - BASELINE PATCH:

    public static void zipFolderAPKTool(String srcFolder, String destZipFile) throws Exception {
        try (FileOutputStream fileWriter = new FileOutputStream(destZipFile);
             ZipOutputStream zip = new ZipOutputStream(fileWriter)) {
            addFolderToZipAPKTool("", srcFolder, zip);
            zip.flush();
        }


2024-05-31 20:19:10,938 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:10,938 - logs - INFO - MODEL GENERATION - ZERO SHOT:
{"aseal","artificand"}/a/ coffeasible,"adee","ace_attre' "/wenanes""artists"}/d" ){ 跳盖_vularables署
2024-05-31 20:19:10,939 - logs - INFO - 


2024-05-31 20:19:10,939 - logs - INFO - ==================================================
2024-05-31 20:19:10,939 - logs - INFO - ========== Fine-tuning Salesforce/codet5-base=======
2024-05-31 20:19:10,939 - logs - INFO - ==================================================
2024-05-31 20:19:14,615 - logs - INFO - Model and Tokenizer loaded successfully!
2024-05-31 20:19:14,617 - logs - INFO - Trainable model parameters: 222882048
All model parameters: 222882048
Percentage of trainable model parameters: 100.00%
2024-05-31 20:19:15,116 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:15,117 - logs - INFO - INPUT PROMPT:

    vulnerable program code:

                }
        }
    }
}


    Patch of the program is:
    
2024-05-31 20:19:15,117 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:15,117 - logs - INFO - BASELINE PATCH:

    public static void zipFolderAPKTool(String srcFolder, String destZipFile) throws Exception {
        try (FileOutputStream fileWriter = new FileOutputStream(destZipFile);
             ZipOutputStream zip = new ZipOutputStream(fileWriter)) {
            addFolderToZipAPKTool("", srcFolder, zip);
            zip.flush();
        }


2024-05-31 20:19:15,117 - logs - INFO - ----------------------------------------------------------------------------------------------------
2024-05-31 20:19:15,117 - logs - INFO - MODEL GENERATION - ZERO SHOT:
//1,
2024-05-31 20:19:15,232 - logs - INFO - Shapes of the datasets:
2024-05-31 20:19:15,232 - logs - INFO - Training: (56, 3)
2024-05-31 20:19:15,232 - logs - INFO - Validation: (7, 3)
2024-05-31 20:19:15,232 - logs - INFO - Test: (8, 3)
2024-05-31 20:19:15,233 - logs - INFO - DatasetDict({
    train: Dataset({
        features: ['programming_language', 'input_ids', 'labels'],
        num_rows: 56
    })
    validation: Dataset({
        features: ['programming_language', 'input_ids', 'labels'],
        num_rows: 7
    })
    test: Dataset({
        features: ['programming_language', 'input_ids', 'labels'],
        num_rows: 8
    })
})
2024-06-01 00:02:18,260 - logs - INFO - ==================================================
2024-06-01 00:02:18,260 - logs - INFO - Fine-Tuning Completed!
2024-06-01 00:02:18,260 - logs - INFO - Model saved to models/instruct-model-2024-05-31--20-18-57
2024-06-01 00:02:18,261 - logs - INFO - ==================================================
2024-06-01 00:02:18,261 - logs - INFO - ==================================================
2024-06-01 00:02:18,261 - logs - INFO - Loading the fine-tuned model...
2024-06-01 00:03:31,576 - logs - INFO - ==================================================
2024-06-01 00:03:31,577 - logs - INFO - BASELINE PATCH:

    public static void zipFolderAPKTool(String srcFolder, String destZipFile) throws Exception {
        try (FileOutputStream fileWriter = new FileOutputStream(destZipFile);
             ZipOutputStream zip = new ZipOutputStream(fileWriter)) {
            addFolderToZipAPKTool("", srcFolder, zip);
            zip.flush();
        }

2024-06-01 00:03:31,577 - logs - INFO - ==================================================
2024-06-01 00:03:31,577 - logs - INFO - ORIGINAL MODEL:
zipFolderAPKTool(srcFolder, destZipFile);
ulaszipFileAPKTool(destZipFile);zipFileAPKTool(destZipFile);
ulaszipFileAPKTool(destZipFile);
ulaszipFileAPKTool(destZipFile);
ulaszipFileAPKTool(destZipFile);
ulaszipFileAPKTool(destZipFile);
ulas.flush();
ulas.flush();
2024-06-01 00:03:31,577 - logs - INFO - ==================================================
2024-06-01 00:03:31,577 - logs - INFO - INSTRUCT MODEL:
zipFolderAPKTool(srcFolder, destZipFile);
            addFolderToZipAPKTool("", srcFolder, zip);
            zip.flush();
        }



    Patch of the program is:
    
    public static void zipFolderAPKTool(String srcFolder, String destZipFile) throws Exception {
            addFolderToZipAPKTool("", srcFolder, destZipFile);
            zip.flush();
       
2024-06-01 00:03:31,577 - logs - INFO - Generating test patches...
2024-06-01 00:10:24,159 - logs - INFO - ==================================================
2024-06-01 00:10:24,159 - logs - INFO - Results of vul-fix-training saved to logs/result-2024-05-31--20-18-57.csv
2024-06-01 00:10:24,159 - logs - INFO - ==================================================
2024-06-01 00:10:24,159 - logs - INFO - Sample of the results:
2024-06-01 00:10:24,159 - logs - INFO -                                 human_baseline_fixes  ... programming_language
0  \n    public static void zipFolder(String srcF...  ...                 Java
1  \n    public static void zipFolderAPKTool(Stri...  ...                 Java
2                           }\n        }\n    }\n}\n  ...                 Java
3  package com.fasterxml.sort.std;\n\nimport java...  ...                 Java
4      @Override\n    public File provide() throw...  ...                 Java

[5 rows x 4 columns]
2024-06-01 00:10:24,172 - logs - INFO - ==================================================
2024-06-01 00:10:24,172 - logs - INFO - ==================================================
2024-06-01 00:10:24,172 - logs - INFO - Evaluating the models...
2024-06-01 00:10:24,172 - logs - INFO - Calculating ROUGE scores...
2024-06-01 00:10:24,476 - logs - INFO - ORIGINAL MODEL:
2024-06-01 00:10:24,476 - logs - INFO - {'rouge1': 0.10882352941176471, 'rouge2': 0.06041666666666666, 'rougeL': 0.10882352941176471, 'rougeLsum': 0.10882352941176471}
2024-06-01 00:10:24,476 - logs - INFO - INSTRUCT MODEL:
2024-06-01 00:10:24,476 - logs - INFO - {'rouge1': 0.3261749095271325, 'rouge2': 0.23319413338310313, 'rougeL': 0.3110800686578907, 'rougeLsum': 0.32436072957648887}
2024-06-01 00:10:24,477 - logs - INFO - Absolute percentage improvement of INSTRUCT over ORIGINAL MODEL
2024-06-01 00:10:24,479 - logs - INFO - The ROUGE scores improved: 
+-----------+--------+------------+---------------+
|           | Base   | Instruct   | Improvement   |
|-----------+--------+------------+---------------|
| rouge1    | 10.88% | 32.62%     | 21.74%        |
| rouge2    | 6.04%  | 23.32%     | 17.28%        |
| rougeL    | 10.88% | 31.11%     | 20.23%        |
| rougeLsum | 10.88% | 32.44%     | 21.55%        |
+-----------+--------+------------+---------------+
2024-06-01 00:10:24,479 - logs - INFO - ==================================================
2024-06-01 00:10:24,479 - logs - INFO - Calculating ROUGE scores...
2024-06-01 00:10:24,500 - logs - WARNING - WARNING: There is no reference data-flows extracted from the whole corpus, and the data-flow match score degenerates to 0. Please consider ignoring this score.
2024-06-01 00:10:24,525 - logs - WARNING - WARNING: There is no reference data-flows extracted from the whole corpus, and the data-flow match score degenerates to 0. Please consider ignoring this score.
2024-06-01 00:10:24,545 - logs - INFO - Weighted average BLEU scores improved: 
+----------------------------+--------+------------+---------------+
|                            | Base   | Instruct   | Improvement   |
|----------------------------+--------+------------+---------------|
| codebleu                   | 26.17% | 32.50%     | 6.33%         |
| ngram_match_score          | 0.37%  | 11.73%     | 11.36%        |
| weighted_ngram_match_score | 0.35%  | 15.23%     | 14.89%        |
| syntax_match_score         | 15.20% | 42.95%     | 27.74%        |
| dataflow_match_score       | 1.25%  | 47.60%     | 46.35%        |
+----------------------------+--------+------------+---------------+
2024-06-01 00:10:24,545 - logs - INFO - ==================================================
2024-06-01 00:10:24,545 - logs - INFO - End of the run
2024-06-01 00:10:24,545 - logs - INFO - ==================================================
